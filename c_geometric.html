<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Denis Berroeta">
<meta name="dcterms.date" content="2026-02-24">

<title>2&nbsp; Corrección Geométrica – Guía Técnica MBHT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./c_geometric.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Corrección Geométrica</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Guía Técnica MBHT</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./c_geometric.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Corrección Geométrica</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bibliografía</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anexos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Anexos</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contenidos</h2>
   
  <ul>
  <li><a href="#por-qué-fue-necesaria-esta-corrección" id="toc-por-qué-fue-necesaria-esta-corrección" class="nav-link active" data-scroll-target="#por-qué-fue-necesaria-esta-corrección"><span class="header-section-number">2.1</span> ¿Por qué fue necesaria esta corrección?</a></li>
  <li><a href="#tipos-de-problemas" id="toc-tipos-de-problemas" class="nav-link" data-scroll-target="#tipos-de-problemas"><span class="header-section-number">2.2</span> Tipos de Problemas</a></li>
  <li><a href="#principio-de-redistribución" id="toc-principio-de-redistribución" class="nav-link" data-scroll-target="#principio-de-redistribución"><span class="header-section-number">2.3</span> Principio de redistribución</a></li>
  <li><a href="#explicación-paso-a-paso-del-proceso" id="toc-explicación-paso-a-paso-del-proceso" class="nav-link" data-scroll-target="#explicación-paso-a-paso-del-proceso"><span class="header-section-number">2.4</span> Explicación paso a paso del proceso</a>
  <ul class="collapse">
  <li><a href="#ingesta-y-preparación-de-geometrías" id="toc-ingesta-y-preparación-de-geometrías" class="nav-link" data-scroll-target="#ingesta-y-preparación-de-geometrías">Ingesta y preparación de geometrías</a></li>
  <li><a href="#identificación-de-casos-problemáticos-y-separación-de-partes" id="toc-identificación-de-casos-problemáticos-y-separación-de-partes" class="nav-link" data-scroll-target="#identificación-de-casos-problemáticos-y-separación-de-partes">Identificación de casos problemáticos y separación de partes</a></li>
  <li><a href="#construcción-de-una-caché-de-edificaciones-para-las-zonas-relevantes" id="toc-construcción-de-una-caché-de-edificaciones-para-las-zonas-relevantes" class="nav-link" data-scroll-target="#construcción-de-una-caché-de-edificaciones-para-las-zonas-relevantes">Construcción de una caché de edificaciones para las zonas relevantes</a></li>
  <li><a href="#cálculo-intensivo-de-estadísticas-por-polígono" id="toc-cálculo-intensivo-de-estadísticas-por-polígono" class="nav-link" data-scroll-target="#cálculo-intensivo-de-estadísticas-por-polígono">Cálculo intensivo de estadísticas por polígono</a></li>
  <li><a href="#cálculo-de-pesos-de-redistribución-y-consolidación" id="toc-cálculo-de-pesos-de-redistribución-y-consolidación" class="nav-link" data-scroll-target="#cálculo-de-pesos-de-redistribución-y-consolidación">Cálculo de pesos de redistribución y consolidación</a></li>
  <li><a href="#generación-de-salidas-para-análisis-y-uso-posterior" id="toc-generación-de-salidas-para-análisis-y-uso-posterior" class="nav-link" data-scroll-target="#generación-de-salidas-para-análisis-y-uso-posterior">Generación de salidas para análisis y uso posterior</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Corrección Geométrica</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://cit.uai.cl/denis-berroeta/">Denis Berroeta</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 24, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="por-qué-fue-necesaria-esta-corrección" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="por-qué-fue-necesaria-esta-corrección"><span class="header-section-number">2.1</span> ¿Por qué fue necesaria esta corrección?</h2>
<p>Durante la actualización de la matriz MBHT con base en el Censo 2024, se detectó un problema en la información espacial a nivel de manzana y entidades rurales: en algunos casos, <strong>un mismo ID censal estaba asociado a más de un polígono</strong> físicamente separado.</p>
<p>Esto genera una inconsistencia importante, porque desde el punto de vista cartográfico y analítico una unidad censal con un único identificador debería representar una geometría coherente. Cuando un mismo ID aparece en polígonos separados, pueden producirse errores en:</p>
<ul>
<li>La visualización de resultados,</li>
<li>La agregación y desagregación de variables,</li>
<li>El cálculo de indicadores territoriales,</li>
<li>La interpretación espacial de los datos.</li>
</ul>
<p>Por esta razón, fue necesario implementar una metodología de corrección geométrica que permitiera separar estos casos en polígonos independientes, asignarles nuevos identificadores y redistribuir correctamente la información de sus tablas de atributos.</p>
</section>
<section id="tipos-de-problemas" class="level2 page-columns page-full" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="tipos-de-problemas"><span class="header-section-number">2.2</span> Tipos de Problemas</h2>
<p>El problema observado puede resumirse así: Un ID censal único (por ejemplo, una manzana o entidad rural) aparece representado por múltiples polígonos. Estos polígonos pueden estar <strong>contiguos</strong> (parte de una misma unidad con geometría multipart) <a href="#fig-contiguo" class="quarto-xref">Figura&nbsp;<span>2.1 (a)</span></a>, o <strong>separados</strong> espacialmente de forma evidente (casos problemáticos) <a href="#fig-separada" class="quarto-xref">Figura&nbsp;<span>2.1 (b)</span></a>, como se observa en la siguientes figuras:</p>
<div id="fig-idUnique" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-idUnique-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-idUnique" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-contiguo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-contiguo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/id_contiguo.png" class="img-fluid figure-img" data-ref-parent="fig-idUnique" width="350">
</div>
<figcaption class="quarto-float-caption-margin quarto-subfloat-caption quarto-subfloat-fig" id="fig-contiguo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Geometrías que comparten ID se encuentran contiguas
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-idUnique" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-separada" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-separada-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/id_separado.png" class="img-fluid figure-img" data-ref-parent="fig-idUnique" width="350">
</div>
<figcaption class="quarto-float-caption-margin quarto-subfloat-caption quarto-subfloat-fig" id="fig-separada-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Geometrías que comparten ID se encuentran Separadas espacialemnte
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-idUnique-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Tipos de problemas en geometrías que comparten el mismo ID.
</figcaption>
</figure>
</div>
<p>Desde el punto de vista del procesamiento, esto obliga a responder una pregunta clave:</p>
<blockquote class="blockquote">
<p>Si una unidad censal original se divide en varios polígonos independientes, ¿cómo se distribuyen sus atributos en los nuevos polígonos resultantes?</p>
</blockquote>
<p>La respuesta adoptada en esta metodología fue una distribución proporcional basada en la presencia de edificaciones, utilizando un archivo nacional de <em>buildings</em> (huellas de edificaciones).</p>
</section>
<section id="principio-de-redistribución" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="principio-de-redistribución"><span class="header-section-number">2.3</span> Principio de redistribución</h2>
<p>La metodología se basa en un principio simple pero fundamental: cuando un <strong>ID censal original</strong> debe separarse en más de un polígono, la información asociada a ese ID no puede copiarse de forma idéntica en cada parte, sino que debe <strong>redistribuirse proporcionalmente</strong>. Para ello, se utiliza como criterio la <strong>cantidad y/o superficie de edificaciones</strong> contenidas en cada polígono resultante. Esta decisión metodológica busca que la distribución de atributos refleje mejor la ocupación real del espacio, en lugar de depender únicamente del área del terreno.</p>
<p>El uso de edificaciones como base de redistribución responde a una razón analítica importante: en términos censales y territoriales, la huella construida suele representar de mejor manera la intensidad de uso del espacio. En la práctica, dos polígonos pueden tener áreas similares, pero una concentración muy distinta de construcciones. Por ello, distribuir atributos en función de edificaciones permite una asignación más realista y más consistente con la estructura territorial observada.</p>
<p>Este procedimiento se aplica <strong>solo cuando un mismo ID está representado por más de un polígono</strong>. Si una geometría corresponde a un único polígono, no se requiere redistribución. En cambio, cuando el ID se divide en múltiples partes, se calcula un <strong>peso de diseminación</strong> para cada una de ellas, que luego permite repartir los atributos del registro original de forma proporcional.</p>
<p><strong>Objetivo del procedimiento</strong></p>
<p>El objetivo del flujo, por tanto, es calcular para cada parte geométrica un <strong>peso</strong> (<span class="math inline">w</span>) que permita transferir atributos desde el ID original hacia los nuevos polígonos corregidos. En términos generales, cada polígono resultante recibe un peso y, dentro de cada ID original fragmentado, la suma de esos pesos debe ser igual a 1. Esto asegura que la redistribución mantenga consistencia interna y que posteriormente las variables puedan desagregarse sin alterar el total original.</p>
<p><strong>Enfoque general</strong></p>
<p>A nivel de implementación, el procesamiento se organiza en dos ramas principales que siguen la misma lógica metodológica: una para <strong>manzanas</strong> (<code>mz_*</code>) y otra para <strong>entidades rurales</strong> (<code>ent_*</code>). Aunque se aplican sobre unidades espaciales distintas, ambas ramas comparten el mismo enfoque de corrección y redistribución. En su diseño general, el flujo prioriza cuatro criterios: <strong>consistencia geométrica</strong>, para asegurar que las unidades corregidas sean espacialmente válidas; <strong>eficiencia computacional</strong>, para procesar grandes volúmenes de datos; <strong>reproducibilidad</strong>, para poder repetir y auditar el procedimiento; y <strong>escalabilidad nacional</strong>, considerando que el procesamiento utiliza información espacial de cobertura nacional.</p>
</section>
<section id="explicación-paso-a-paso-del-proceso" class="level2 page-columns page-full" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="explicación-paso-a-paso-del-proceso"><span class="header-section-number">2.4</span> Explicación paso a paso del proceso</h2>
<section id="ingesta-y-preparación-de-geometrías" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ingesta-y-preparación-de-geometrías">Ingesta y preparación de geometrías</h3>
<p>En esta etapa se leen las capas espaciales desde la base de datos (<code>DuckDB</code>) y se realiza una preparación inicial para asegurar que el procesamiento posterior sea confiable.</p>
<p><strong>Qué se hace en esta etapa</strong></p>
<ul>
<li>Lectura de las capas espaciales (manzanas y entidades).</li>
<li>Estandarización del sistema de coordenadas (CRS).</li>
<li>Validación y corrección de geometrías inválidas (<code>st_make_valid</code>).</li>
<li>Cálculo del área base de cada geometría.</li>
</ul>
<p>Esta etapa asegura que las operaciones posteriores —como intersecciones, asignación de edificios o cálculos de superficie— se ejecuten sobre una base geométrica confiable. En términos prácticos, aquí se evita que errores de geometría se propaguen al resto del flujo.</p>
</section>
<section id="identificación-de-casos-problemáticos-y-separación-de-partes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-de-casos-problemáticos-y-separación-de-partes">Identificación de casos problemáticos y separación de partes</h3>
<p>No todos los IDs con geometría multipart generan problemas analíticos, por lo que se evalúa si existen múltiples partes y qué tan separadas están entre sí. Para ello, se calcula la distancia de cada parte respecto del centroide del conjunto, y si alguna supera el umbral definido (por ejemplo, 500 metros) se marca como caso sospechoso y se considera candidata a una validación más detallada con edificaciones.</p>
<p>Como resultado, se construye un maestro de partes geométricas (donde cada parte recibe un ID derivado) y, en paralelo, un subconjunto de partes sospechosas que será analizado con edificaciones. Esta separación permite concentrar el esfuerzo computacional donde realmente importa.</p>
</section>
<section id="construcción-de-una-caché-de-edificaciones-para-las-zonas-relevantes" class="level3 unnumbered page-columns page-full">
<h3 class="unnumbered anchored" data-anchor-id="construcción-de-una-caché-de-edificaciones-para-las-zonas-relevantes">Construcción de una caché de edificaciones para las zonas relevantes</h3>
<p>Una vez identificadas las geometrías que requieren validación, se extraen únicamente las edificaciones relevantes desde el archivo nacional de buildings.</p>
<p><strong>Qué se hace</strong></p>
<ul>
<li>Se agrupan zonas a procesar en <strong>lotes espaciales</strong> (<em>batches</em>).</li>
<li>Se leen edificaciones solo dentro del área de interés (con un pequeño buffer).</li>
<li>Las edificaciones se transforman a una representación más eficiente para consulta (puntos representativos + indexación H3).</li>
<li>Se guarda una caché intermedia en formato <strong>Parquet particionado</strong> (<a href="#fig-hexMz" class="quarto-xref">Figura&nbsp;<span>2.2</span></a>).</li>
</ul>
<div id="fig-hexMz" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-hexMz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/h3-building.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-hexMz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Ejemplo de Caché intermedio de edificaciones en un Hexgono H3 <code>8ab2000cb2b7fff</code> asociado a las Manzanas color naranja.
</figcaption>
</figure>
</div>
<p>Esta información se almacena en Parquet particionado, lo que reduce de forma importante el costo de lectura/escritura (I/O) y acelera el procesamiento global en las etapas siguientes.</p>
</section>
<section id="cálculo-intensivo-de-estadísticas-por-polígono" class="level3 unnumbered page-columns page-full">
<h3 class="unnumbered anchored" data-anchor-id="cálculo-intensivo-de-estadísticas-por-polígono">Cálculo intensivo de estadísticas por polígono</h3>
<p>Esta es la etapa de cálculo intensivo, donde se determina cuántas edificaciones (y/o cuánta superficie construida) corresponden a cada parte de un ID dividido.</p>
<p><strong>Qué se hace en términos generales</strong></p>
<p>Para cada lote de polígonos:</p>
<ol type="1">
<li>Se cargan las edificaciones candidatas desde la caché.</li>
<li>Se realiza la asignación espacial de edificios a polígonos (<em>point-in-polygon</em>) (<a href="#fig-buildingIN" class="quarto-xref">Figura&nbsp;<span>2.3</span></a>).</li>
<li>Se calculan estadísticas por parte geométrica, como:
<ul>
<li>número de edificaciones (<code>n_buildings</code>)</li>
<li>suma de área de edificaciones (<code>area_sum</code>)</li>
</ul></li>
</ol>
<div id="fig-buildingIN" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-buildingIN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/ident-building.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-buildingIN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Se identifican las edificaciones dentro del polígono que se esta evaluando y en ellos se realizan los calculos estadísticos
</figcaption>
</figure>
</div>
<p><strong>Por qué se integró Rust</strong></p>
<p>Porque el cruce geométrico a gran escala (millones de edificios vs.&nbsp;miles de polígonos) puede ser muy costoso en tiempo si se ejecuta de manera tradicional. La integración con Rust permite acelerar el núcleo del cálculo y hacer viable el procesamiento a escala nacional.</p>
</section>
<section id="cálculo-de-pesos-de-redistribución-y-consolidación" class="level3 unnumbered page-columns page-full">
<h3 class="unnumbered anchored" data-anchor-id="cálculo-de-pesos-de-redistribución-y-consolidación">Cálculo de pesos de redistribución y consolidación</h3>
<p>Una vez obtenidas las estadísticas de edificaciones, se calcula el peso de redistribución para cada parte geométrica. La regla principal consiste en asignar pesos proporcionales a la evidencia construida observada dentro de cada parte de un mismo ID original. En términos generales, esto se expresa como la razón entre la medida de edificaciones de una parte en este caso por <strong>área construida</strong> (podría ser por conteo o área construida, según configuración) y el total de esa misma medida en todas las partes del ID original.</p>
<p>Una forma general de expresarlo es:</p>
<p><span class="math display">w_i = \frac{\text{medida de edificaciones en la parte } i}{\sum \text{medida de edificaciones de todas las partes del mismo ID}}</span></p>
<p>Donde la “medida” puede corresponder, según la configuración del flujo, al área total de edificaciones y/o a su conteo.</p>
<p>Cuando no se detectan edificaciones o no corresponde aplicar el cálculo intensivo, se utiliza un método de respaldo (fallback), como distribución proporcional al área del terreno (by_area) o uniforme (uniform).</p>
<div id="fig-tabResults" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-tabResults-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/tab_results.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-tabResults-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Tabla de ejemplos de los resultados de Asignación por área de edificaciones
</figcaption>
</figure>
</div>
<p>El resultado de esta etapa es un dataset consolidado en el que cada parte queda asociada a su ID derivado, su ID original, las estadísticas de edificios (cuando existen) y su peso final de redistribución (<a href="#fig-tabResults" class="quarto-xref">Figura&nbsp;<span>2.4</span></a>). Con ello, la información queda preparada para desagregar los atributos que se deseen.</p>
</section>
<section id="generación-de-salidas-para-análisis-y-uso-posterior" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="generación-de-salidas-para-análisis-y-uso-posterior">Generación de salidas para análisis y uso posterior</h3>
<p>Generación de salidas para análisis, validación e integración. Finalmente, los resultados se exportan en varios formatos para facilitar su uso en distintas etapas del trabajo. Se genera una salida en Parquet para análisis rápido en R/Python y procesamiento masivo, una salida en GeoPackage (GPKG) para revisión cartográfica en software SIG, y tablas en DuckDB para reintegrar el resultado al repositorio central y al pipeline de indicadores. Mantener estas tres salidas en paralelo permite combinar rendimiento analítico, control visual y continuidad operativa dentro del proceso general de actualización de la matriz MBHT</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link" aria-label="Introducción">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="Bibliografía">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bibliografía</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, <a href="https://cit.uai.cl/">Centro de Inteligencia Territorial</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>